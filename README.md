# elm-serial

A minimal working example of using the [Web Serial API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API) from an [Elm](https://elm-lang.org/) application. Intended as a starting point for projects that need to communicate with serial devices (microcontrollers, sensors, etc.) from an Elm-based UI.

## What it does

A simple terminal-style interface that lets you:

- Connect to a serial port at a configurable baud rate
- Send text input line by line
- Display incoming data in a scrolling log
- Show connection status (disconnected / connecting / connected / error)

## How it works

Elm cannot access browser APIs like Web Serial directly, so communication is bridged via [ports](https://guide.elm-lang.org/interop/ports.html):

**Elm → JavaScript (outgoing ports)**

| Port | Purpose |
|------|---------|
| `openPort` | Request a port and open it at the given baud rate |
| `closePort` | Close the current port |
| `sendData` | Write a string to the port |
| `scrollToBottom` | Scroll the terminal view |

**JavaScript → Elm (incoming ports)**

| Port | Purpose |
|------|---------|
| `portOpened` | Notifies Elm that the port is open |
| `portClosed` | Notifies Elm that the port has closed |
| `portError` | Sends an error message string to Elm |
| `dataReceived` | Delivers a chunk of received text to Elm |

The JavaScript side (`ports.js`) uses the Web Serial API — `navigator.serial.requestPort()`, streaming reads, and a `TextDecoder` — and calls back into Elm through the port subscriptions.

## Project structure

```
elm-serial/
├── src/
│   └── Main.elm     # Elm application (model, update, view, port declarations)
├── ports.js         # JavaScript glue: Web Serial API ↔ Elm ports
├── index.html       # Loads elm.js and ports.js, initialises the app
├── elm.json         # Elm package manifest
└── elm.js           # Compiled Elm output (generated by elm make)
```

## Prerequisites

- [Elm 0.19.1](https://guide.elm-lang.org/install/elm.html)
- Chrome 89+ or Edge 89+ (Web Serial API is not available in Firefox or Safari)
- The app must be served from `localhost` or over HTTPS (browser security requirement for Web Serial)

## Getting started

1. Compile the Elm source:

   ```bash
   elm make src/Main.elm --output elm.js
   ```

2. Start elm reactor:

   ```bash
   elm reactor
   ```

3. Open `http://localhost:8000/index.html` in Chrome or Edge, select a baud rate, and click **Connect**.

## Using this as a starting point

The ports interface in `src/Main.elm` and `ports.js` is the key pattern to take and adapt:

- **Add more ports** to expose other serial options (data bits, parity, flow control).
- **Replace the terminal view** with domain-specific UI — graphs, gauges, control panels, etc.
- **Parse incoming data** in the Elm `DataReceived` branch instead of logging raw text.
- **Add commands** beyond plain text — binary framing, packet protocols, etc.

The JavaScript in `ports.js` is self-contained and has no dependencies, so it is easy to drop into any Elm project.

## Browser compatibility

Web Serial is a Chrome/Edge-only API. Check current support at [caniuse.com](https://caniuse.com/web-serial).
